name: Build for OpenWrt (x86)

on: [push, workflow_dispatch]

env:
  DOTNET_SDK_VERSION: '9.0.*'

jobs:
  build-openwrt-x86:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1

      - name: Set up dotnet
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: ${{ env.DOTNET_SDK_VERSION }}

      - name: Publish for OpenWrt (x86 musl)
        run: |
          dotnet publish BBDown -r linux-musl-x64 -c Release --self-contained true -o artifact # 针对 musl libc 的 x64 构建
          # 如果你的OpenWrt是32位的x86，则使用 linux-musl-x86
          # dotnet publish BBDown -r linux-musl-x86 -c Release --self-contained true -o artifact

      - name: Package for OpenWrt
        run: |
          cd artifact
          tar -czvf BBDown_openwrt_x86.tar.gz * # 使用 tar.gz 压缩

      - name: Upload Artifact
        uses: actions/upload-artifact@v3.1.3
        with:
          name: BBDown_openwrt_x86
          path: BBDown_openwrt_x86.tar.gz
